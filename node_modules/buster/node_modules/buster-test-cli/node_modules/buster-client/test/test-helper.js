var http = require("http");
var buster = require("buster");

exports.createServerFor = function (testCase, callback) {
    var requests = [];

    testCase.server = http.createServer(function (req, res) {
        req.body = "";
        req.on("data", function (chunk) { req.body += chunk; });

        req.on("end", function () {
            requests.push(req);
            res.writeHead(testCase.responseCode || 200);
            res.end(testCase.responseText || "");
        });
    });

    testCase.server.listen(7777, "localhost", function () {
        callback();
    });

    return requests;
};